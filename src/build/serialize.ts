import type { FlatConfigArray } from "../types.ts"

/**
 * Serializes a flat config array to a JavaScript module string.
 * The output is a self-contained ES module that can be dynamically imported.
 */
export function serializeConfig(config: FlatConfigArray): string {
  const lines: string[] = [
    "// Auto-generated by @effective/eslint-config â€” do not edit",
    "// @ts-nocheck",
    `export default ${JSON.stringify(config, replacer, 2)};`,
    "",
  ]

  return lines.join("\n")
}

function replacer(_key: string, value: unknown): unknown {
  if (typeof value === "function") {
    return `__FUNCTION__${value.toString()}`
  }
  if (value instanceof RegExp) {
    return `__REGEXP__${value.toString()}`
  }
  return value
}
